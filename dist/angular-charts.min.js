var angularCharts=angularCharts||{utils:{colorPicker:{colors:["steelBlue","rgb(255,153,0)","rgb(220,57,18)","rgb(70,132,238)","rgb(73,66,204)","rgb(0,128,0)"],getRandomColor:function(){for(var a="0123456789ABCDEF".split(""),b="#",c=0;6>c;c++)b+=a[Math.round(15*Math.random())];return b},getColor:function(a){if(a<this.colors.length)return this.colors[a];var b=this.getRandomColor();return this.colors.push(b),b}}}};angularCharts.ChartController=function(a,b,c,d,e){function f(){var b=a.acData;h=a.acChart,m.series=a.acSeries||b.series,m.points=a.acPoints||b.data,a.acConfig&&angular.extend(k,a.acConfig),angularCharts[h+"Chart"](g(),m)}function g(){var e=c.get("chart");return b.html(d(e)(a)),i=b.find(".ac-chart"),j=b.find(".ac-legend"),i}var h,i,j,k={tooltips:!0,labels:!1,mouseover:function(){},mouseout:function(){},click:function(){}},l={style:["display:none;","position:absolute;","border:1px solid #333;","background-color:#161616;","border-radius:5px;","padding:5px;","color:#fff;"].join(""),create:function(a){k.tooltips&&angular.element('<p class="ac-tooltip" style="'+this.style+'"></p>').html(a).appendTo("body").fadeIn("slow")},remove:function(){angular.element(".ac-tooltip").remove()},update:function(){angular.element(".ac-tooltip").css({left:d3.event.pageX+20,top:d3.event.pageY-30})}},m={showLabels:k.labels,mouseover:function(a){k.mouseover(),l.create(a)},mouseout:function(){},mouseleave:function(){l.remove()},mousemove:function(){k.mouseout(),l.update()},click:function(){k.click()},getDimensions:function(){return i[0].getBoundingClientRect()},getColor:function(a){return angularCharts.utils.colorPicker.getColor(a)}},n=angular.element(e);a.getWindowDimensions=function(){return{h:n.height(),w:n.width()}},a.$watch("acChart",function(){f()},!0),a.$watch("acData",function(){f()},!0),a.$watch("acConfig",function(){f()},!0),a.$watch("acSeries",function(){f()},!0),a.$watch("acPoints",function(){f()},!0)};var angularCharts=angularCharts||{};angularCharts.areaChart=function(a,b,c,d,e,f){function g(a){return Math.round(i(a))+i.rangeBand()/2}var h={top:0,right:40,bottom:20,left:40};b-=h.left+h.right,c-=h.top+h.bottom;var i=d3.scale.ordinal().domain(d.map(function(a){return a.x})).rangeRoundBands([0,b]),j=d3.scale.linear().range([c,10]),k=d3.svg.axis().scale(i).orient("bottom"),l=d3.svg.axis().scale(j).orient("left").ticks(5).tickFormat(d3.format("s")),m=[0],n=[];d.forEach(function(a){a.y.map(function(a){m.push(a)})});var o=d3.max(d.map(function(a){return a.y.length}));f.yMaxData=o,series.slice(0,o).forEach(function(a,b){var c={};c.series=a,c.values=d.map(function(a){return a.y.map(function(b){return{x:a.x,y:b}})[b]||{x:d[b].x,y:0}}),n.push(c)});var p=d3.select(a[0]).append("svg").attr("width",b+h.left+h.right).attr("height",c+h.top+h.bottom).append("g").attr("transform","translate("+h.left+","+h.top+")"),q=.2*d3.max(m);j.domain([d3.min(m),d3.max(m)+q]),p.append("g").attr("class","x axis").attr("transform","translate(0,"+c+")").call(k),p.append("g").attr("class","y axis").call(l);var r=p.selectAll(".points").data(n).enter().append("g"),s=d3.svg.area().interpolate("basis").x(function(a){return g(a.x)}).y0(function(){return j(0)}).y1(function(a){return j(0+a.y)});r.append("path").attr("class","area").attr("d",function(a){return s(a.values)}).style("fill",function(a,b){return getColor(b)}).style("opacity","0.7")};var angularCharts=angularCharts||{};angularCharts.barChart=function(a,b){var c=b.getDimensions().width,d=b.getDimensions().height||c,e={top:0,right:20,bottom:30,left:40};c-=e.left+e.right,d-=e.top+e.bottom;var f=d3.scale.ordinal().rangeRoundBands([0,c],.1),g=d3.scale.linear().range([d,10]),h=d3.scale.ordinal().rangeRoundBands([0,c],.1),i=[0];b.points.forEach(function(a){a.nicedata=a.y.map(function(b,c){return i.push(b),{x:a.x,y:b,s:c}})});var j=d3.max(b.points.map(function(a){return a.y.length}));f.domain(b.points.map(function(a){return a.x}));var k=.2*d3.max(i);g.domain([d3.min(i),d3.max(i)+k]),h.domain(d3.range(j)).rangeRoundBands([0,f.rangeBand()]);var l=d3.svg.axis().scale(f).orient("bottom"),m=d3.svg.axis().scale(g).orient("left").ticks(10).tickFormat(d3.format("s")),n=d3.select(a[0]).append("svg").attr("width",c+e.left+e.right).attr("height",d+e.top+e.bottom).append("g").attr("transform","translate("+e.left+","+e.top+")");n.append("g").attr("class","x axis").attr("transform","translate(0,"+d+")").call(l),n.append("g").attr("class","y axis").call(m);var o=n.selectAll(".state").data(b.points).enter().append("g").attr("class","g").attr("transform",function(a){return"translate("+f(a.x)+",0)"}),p=o.selectAll("rect").data(function(a){return a.nicedata}).enter().append("rect");p.attr("width",h.rangeBand()),p.attr("x",function(a,b){return h(b)}).attr("y",d).style("fill",function(a,c){return b.getColor(c)}).attr("height",0).transition().ease("cubic-in-out").duration(1e3).attr("y",function(a){return g(Math.max(0,a.y))}).attr("height",function(a){return Math.abs(g(a.y)-g(0))}),p.on("mouseover",function(){b.mouseover(arguments)}).on("mouseleave",function(){b.mouseleave(arguments)}).on("mousemove",function(){b.mousemove(arguments)}).on("click",function(){b.click(arguments)}),b.showLabels&&o.selectAll("not-a-class").data(function(a){return a.nicedata}).enter().append("text").attr("x",function(a,b){return h(b)}).attr("y",function(a){return d-Math.abs(g(a.y)-g(0))}).text(function(a){return a.y}),n.append("line").attr("x1",c).attr("y1",g(0)).attr("y2",g(0)).style("stroke","silver")};var angularCharts=angularCharts||{};angularCharts.lineChart=function(a,b,c,d,e,f){function g(a){return Math.round(i(a))+i.rangeBand()/2}var h={top:0,right:40,bottom:20,left:40};b-=h.left+h.right,c-=h.top+h.bottom;var i=d3.scale.ordinal().domain(d.map(function(a){return a.x})).rangeRoundBands([0,b]),j=d3.scale.linear().range([c,10]),k=d3.svg.axis().scale(i).orient("bottom"),l=d3.svg.axis().scale(j).orient("left").ticks(5).tickFormat(d3.format("s")),m=d3.svg.line().interpolate("cardinal").x(function(a){return g(a.x)}).y(function(a){return j(a.y)}),n=[0],o=[];d.forEach(function(a){a.y.map(function(a){n.push(a)})});var p=d3.max(d.map(function(a){return a.y.length}));series.slice(0,p).forEach(function(a,b){var c={};c.series=a,c.values=d.map(function(a){return a.y.map(function(b){return{x:a.x,y:b}})[b]||{x:d[b].x,y:0}}),o.push(c)});var q=d3.select(a[0]).append("svg").attr("width",b+h.left+h.right).attr("height",c+h.top+h.bottom).append("g").attr("transform","translate("+h.left+","+h.top+")"),r=.2*d3.max(n);j.domain([d3.min(n),d3.max(n)+r]),q.append("g").attr("class","x axis").attr("transform","translate(0,"+c+")").call(k),q.append("g").attr("class","y axis").call(l);var s=q.selectAll(".points").data(o).enter().append("g");path=s.attr("points","points").append("path").attr("class","ac-line").style("stroke",function(a,b){return getColor(b)}).attr("d",function(a){return m(a.values)}).attr("stroke-width","2").attr("fill","none");var t=o[o.length-1].values,u=path.node().getTotalLength()+g(t[t.length-1].x);return path.attr("stroke-dasharray",u+" "+u).attr("stroke-dashoffset",u).transition().duration(1500).ease("linear").attr("stroke-dashoffset",0).attr("d",function(a){return m(a.values)}),angular.forEach(o,function(a){var b=q.selectAll(".circle").data(a.values).enter();b.append("circle").attr("cx",function(a){return g(a.x)}).attr("cy",function(a){return j(a.y)}).attr("r",3).style("fill",getColor(o.indexOf(a))).style("stroke",getColor(o.indexOf(a))).on("mouseover",function(a){makeToolTip(a.tooltip||a.y),e.mouseover(a),f.$apply()}).on("mouseleave",function(a){removeToolTip(),e.mouseout(a),f.$apply()}).on("mousemove",function(){updateToolTip()}).on("click",function(a){e.click(a),f.$apply()}),e.labels&&b.append("text").attr("x",function(a){return g(a.x)}).attr("y",function(a){return j(a.y)}).text(function(a){return a.y})}),s.append("text").datum(function(a){return{name:a.series,value:a.values[a.values.length-1]}}).attr("transform",function(a){return"translate("+g(a.value.x)+","+j(a.value.y)+")"}).attr("x",3).text(function(a){return a.name}),o};var angularCharts=angularCharts||{};angularCharts.pieChart=function(a,b){function c(a){a.innerRadius=0;var b=d3.interpolate({startAngle:0,endAngle:0},a);return function(a){return h(b(a))}}var d=b.getDimensions().width,e=b.getDimensions().height||d,f=Math.min(d,e)/2,g=d3.select(a[0]).append("svg").attr("width",d).attr("height",e).append("g").attr("transform","translate("+d/2+","+e/2+")"),h=d3.svg.arc().outerRadius(f-10).innerRadius(0);d3.svg.arc().outerRadius(f+5).innerRadius(0);var i=d3.layout.pie().sort(null).value(function(a){return a.y[0]}),j=g.selectAll(".arc").data(i(b.points)).enter().append("g");j.append("path").style("fill",function(a,c){return b.getColor(c)}).transition().ease("linear").duration(500).attrTween("d",c).attr("class","arc"),j.on("mouseover",function(a){d3.select(this).select("path").transition().duration(200).style("stroke","white").style("stroke-width","2px"),b.mouseover(a.data.tooltip||a.value)}).on("mouseleave",function(){d3.select(this).select("path").transition().duration(200).style("stroke","").style("stroke-width",""),b.mouseleave(arguments)}).on("mousemove",function(){b.mousemove(arguments)}).on("click",function(){b.click(arguments)}),b.showLabels&&j.append("text").attr("transform",function(a){return"translate("+h.centroid(a)+")"}).attr("dy",".35em").style("text-anchor","middle").text(function(a){return a.data.y[0]})};var angularCharts=angularCharts||{};angularCharts.pointChart=function(a,b,c,d,e,f){function g(a){return Math.round(i(a))+i.rangeBand()/2}var h={top:0,right:40,bottom:20,left:40};b-=h.left-h.right,c-=h.top-h.bottom;var i=d3.scale.ordinal().domain(d.map(function(a){return a.x})).rangeRoundBands([0,b]),j=d3.scale.linear().range([c,10]),k=d3.svg.axis().scale(i).orient("bottom"),l=d3.svg.axis().scale(j).orient("left").ticks(5).tickFormat(d3.format("s")),m=[0],n=[];d.forEach(function(a){a.y.map(function(a){m.push(a)})});var o=d3.max(d.map(function(a){return a.y.length}));f.yMaxPoints=o,series.slice(0,o).forEach(function(a,b){var c={};c.series=a,c.values=d.map(function(a){return a.y.map(function(b){return{x:a.x,y:b}})[b]||{x:d[b].x,y:0}}),n.push(c)});var p=d3.select(a[0]).append("svg").attr("width",b+h.left+h.right).attr("height",c+h.top+h.bottom).append("g").attr("transform","translate("+h.left+","+h.top+")"),q=.2*d3.max(m);j.domain([d3.min(m),d3.max(m)+q]),p.append("g").attr("class","x axis").attr("transform","translate(0,"+c+")").call(k),p.append("g").attr("class","y axis").call(l),p.selectAll(".points").data(n).enter().append("g"),angular.forEach(n,function(a){var b=p.selectAll(".circle").data(a.values).enter();b.append("circle").attr("cx",function(a){return g(a.x)}).attr("cy",function(a){return j(a.y)}).attr("r",3).style("fill",getColor(n.indexOf(a))).style("stroke",getColor(n.indexOf(a))).on("mouseover",function(a){makeToolTip(a.tooltip||a.y),e.mouseover(a),f.$apply()}).on("mouseleave",function(a){removeToolTip(),e.mouseout(a),f.$apply()}).on("mousemove",function(){updateToolTip()}).on("click",function(a){e.click(a),f.$apply()}),e.labels&&b.append("text").attr("x",function(a){return g(a.x)}).attr("y",function(a){return j(a.y)}).text(function(a){return a.y})})};var angularCharts=angularCharts||{};angular.module("angularCharts",["angularChartsTemplates"]),angular.module("angularCharts").directive("acChart",["$templateCache","$compile","$window",function(){function a(){}return{restrict:"EA",link:a,controller:angularCharts.ChartController,scope:{acChart:"=",acData:"=",acConfig:"="}}}]),angular.module("angularCharts").directive("acLegend",["$templateCache","$compile","$window",function(a,b){function c(c,d){var e=a.get("legend");d.html(b(e)(c))}return{restrict:"EA",link:c,controller:["$scope",function(a){function b(){a.legends=[],"pie"==a.acLegend?angular.forEach(a.acPoints,function(b,c){a.legends.push({color:angularCharts.utils.colorPicker.getColor(c),title:b.x})}):angular.forEach(a.acSeries,function(b,c){a.legends.push({color:angularCharts.utils.colorPicker.getColor(c),title:b})})}a.$watch("acLegend",b,!0),a.$watch("acSeries",b,!0),a.$watch("acPoints",b,!0)}],scope:{acPoints:"=",acColors:"=",acLegend:"=",acSeries:"="}}}]),angular.module("angularChartsTemplates",["chart","legend"]),angular.module("chart",[]).run(["$templateCache",function(a){a.put("chart","<style>\n    .axis path,\n    .axis line {\n        fill: none;\n        stroke: #333;\n    }\n    .ac-line {\n        fill:none;\n        stroke-width:2px;\n    }\n</style>\n<div class='ac-chart' ></div>")}]),angular.module("legend",[]).run(["$templateCache",function(a){a.put("legend","<div class='ac-legend'>\n    <table>\n        <tr ng-repeat=\"l in legends\">\n            <td><div ng-attr-style='background:{{l.color}}; height:15px;width:15px;'></div></td>\n            <td ng-bind='l.title'></td>\n        </tr>\n    </table>\n</div>")}]);