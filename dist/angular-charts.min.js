var angularCharts=angularCharts||{utils:{colorPicker:{colors:["steelBlue","rgb(255,153,0)","rgb(220,57,18)","rgb(70,132,238)","rgb(73,66,204)","rgb(0,128,0)"],getRandomColor:function(){for(var a="0123456789ABCDEF".split(""),b="#",c=0;6>c;c++)b+=a[Math.round(15*Math.random())];return b},getColor:function(a){if(a<this.colors.length)return this.colors[a];var b=this.getRandomColor();return this.colors.push(b),b}}}};angularCharts.ChartController=function(a,b,c,d,e){function f(){var b=a.acData;h=a.acChart,m.series=a.acSeries||b.series||[],m.points=a.acPoints||b.data||[],a.acConfig&&angular.extend(k,a.acConfig),angularCharts[h+"Chart"](g(),m)}function g(){var e=c.get("chart");return b.html(d(e)(a)),i=b.find(".ac-chart"),j=b.find(".ac-legend"),i}var h,i,j,k={tooltips:!0,labels:!1,mouseover:function(){},mouseout:function(){},click:function(){}},l={style:["display:none;","position:absolute;","border:1px solid #333;","background-color:#161616;","border-radius:5px;","padding:5px;","color:#fff;"].join(""),create:function(a){k.tooltips&&angular.element('<p class="ac-tooltip" style="'+this.style+'"></p>').html(a).appendTo("body").fadeIn("slow")},remove:function(){angular.element(".ac-tooltip").remove()},update:function(){angular.element(".ac-tooltip").css({left:d3.event.pageX+20,top:d3.event.pageY-30})}},m={showLabels:k.labels,mouseover:function(a){k.mouseover();var b=a[0].data||a[0];l.create(b.tooltip||b.y[0]||b.y)},mouseout:function(){},mouseleave:function(){l.remove()},mousemove:function(){k.mouseout(),l.update()},click:function(){k.click()},getDimensions:function(){return i[0].getBoundingClientRect()},getColor:function(a){return angularCharts.utils.colorPicker.getColor(a)}},n=angular.element(e);a.getWindowDimensions=function(){return{h:n.height(),w:n.width()}},a.$watch("acChart",function(){f()},!0),a.$watch("acData",function(){f()},!0),a.$watch("acConfig",function(){f()},!0),a.$watch("acSeries",function(){f()},!0),a.$watch("acPoints",function(){f()},!0)};var angularCharts=angularCharts||{};angularCharts.areaChart=function(a,b){function c(a){return Math.round(g(a))+g.rangeBand()/2}var d=b.getDimensions().width,e=b.getDimensions().height||d,f={top:0,right:40,bottom:20,left:40};d-=f.left+f.right,e-=f.top+f.bottom;var g=d3.scale.ordinal().domain(b.points.map(function(a){return a.x})).rangeRoundBands([0,d]),h=d3.scale.linear().range([e,10]),i=d3.svg.axis().scale(g).orient("bottom"),j=d3.svg.axis().scale(h).orient("left").ticks(5).tickFormat(d3.format("s")),k=[0],l=[];b.points.forEach(function(a){a.y.map(function(a){k.push(a)})});var m=d3.max(b.points.map(function(a){return a.y.length}));b.series.slice(0,m).forEach(function(a,c){var d={};d.series=a,d.values=b.points.map(function(a){return a.y.map(function(b){return{x:a.x,y:b}})[c]||{x:b.points[c].x,y:0}}),l.push(d)});var n=d3.select(a[0]).append("svg").attr("width",d+f.left+f.right).attr("height",e+f.top+f.bottom).append("g").attr("transform","translate("+f.left+","+f.top+")"),o=.2*d3.max(k);h.domain([d3.min(k),d3.max(k)+o]),n.append("g").attr("class","x axis").attr("transform","translate(0,"+e+")").call(i),n.append("g").attr("class","y axis").call(j);var p=n.selectAll(".points").data(l).enter().append("g"),q=d3.svg.area().interpolate("basis").x(function(a){return c(a.x)}).y0(function(){return h(0)}).y1(function(a){return h(0+a.y)});p.append("path").attr("class","area").attr("d",function(a){return q(a.values)}).style("fill",function(a,c){return b.getColor(c)}).style("opacity","0.7")};var angularCharts=angularCharts||{};angularCharts.barChart=function(a,b){var c=b.getDimensions().width,d=b.getDimensions().height||c,e={top:0,right:20,bottom:30,left:40};c-=e.left+e.right,d-=e.top+e.bottom;var f=d3.scale.ordinal().rangeRoundBands([0,c],.1),g=d3.scale.linear().range([d,10]),h=d3.scale.ordinal().rangeRoundBands([0,c],.1),i=[0];b.points.forEach(function(a){a.nicedata=a.y.map(function(b,c){return i.push(b),{x:a.x,y:b,s:c}})});var j=d3.max(b.points.map(function(a){return a.y.length}));f.domain(b.points.map(function(a){return a.x}));var k=.2*d3.max(i);g.domain([d3.min(i),d3.max(i)+k]),h.domain(d3.range(j)).rangeRoundBands([0,f.rangeBand()]);var l=d3.svg.axis().scale(f).orient("bottom"),m=d3.svg.axis().scale(g).orient("left").ticks(10).tickFormat(d3.format("s")),n=d3.select(a[0]).append("svg").attr("width",c+e.left+e.right).attr("height",d+e.top+e.bottom).append("g").attr("transform","translate("+e.left+","+e.top+")");n.append("g").attr("class","x axis").attr("transform","translate(0,"+d+")").call(l),n.append("g").attr("class","y axis").call(m);var o=n.selectAll(".state").data(b.points).enter().append("g").attr("class","g").attr("transform",function(a){return"translate("+f(a.x)+",0)"}),p=o.selectAll("rect").data(function(a){return a.nicedata}).enter().append("rect");p.attr("width",h.rangeBand()),p.attr("x",function(a,b){return h(b)}).attr("y",d).style("fill",function(a,c){return b.getColor(c)}).attr("height",0).transition().ease("cubic-in-out").duration(1e3).attr("y",function(a){return g(Math.max(0,a.y))}).attr("height",function(a){return Math.abs(g(a.y)-g(0))}),p.on("mouseover",function(){b.mouseover.call(b,arguments)}).on("mouseleave",function(){b.mouseleave.call(b,arguments)}).on("mousemove",function(){b.mousemove.call(b,arguments)}).on("click",function(){b.click.call(b,arguments)}),b.showLabels&&o.selectAll("not-a-class").data(function(a){return a.nicedata}).enter().append("text").attr("x",function(a,b){return h(b)}).attr("y",function(a){return d-Math.abs(g(a.y)-g(0))}).text(function(a){return a.y}),n.append("line").attr("x1",c).attr("y1",g(0)).attr("y2",g(0)).style("stroke","silver")};var angularCharts=angularCharts||{};angularCharts.lineChart=function(a,b){function c(a){return Math.round(g(a))+g.rangeBand()/2}var d=b.getDimensions().width,e=b.getDimensions().height||d,f={top:0,right:40,bottom:20,left:40};d-=f.left+f.right,e-=f.top+f.bottom;var g=d3.scale.ordinal().domain(b.points.map(function(a){return a.x})).rangeRoundBands([0,d]),h=d3.scale.linear().range([e,10]),i=d3.svg.axis().scale(g).orient("bottom"),j=d3.svg.axis().scale(h).orient("left").ticks(5).tickFormat(d3.format("s")),k=d3.svg.line().interpolate("cardinal").x(function(a){return c(a.x)}).y(function(a){return h(a.y)}),l=[0],m=[];b.points.forEach(function(a){a.y.map(function(a){l.push(a)})});var n=d3.max(b.points.map(function(a){return a.y.length}));b.series.slice(0,n).forEach(function(a,c){var d={};d.series=a,d.values=b.points.map(function(a){return a.y.map(function(b){return{x:a.x,y:b}})[c]||{x:b.points[c].x,y:0}}),m.push(d)});var o=d3.select(a[0]).append("svg").attr("width",d+f.left+f.right).attr("height",e+f.top+f.bottom).append("g").attr("transform","translate("+f.left+","+f.top+")"),p=.2*d3.max(l);h.domain([d3.min(l),d3.max(l)+p]),o.append("g").attr("class","x axis").attr("transform","translate(0,"+e+")").call(i),o.append("g").attr("class","y axis").call(j);var q=o.selectAll(".helper.points").data(m).enter().append("g");path=q.attr("helper.points","helper.points").append("path").attr("class","ac-line").style("stroke",b.getColor).attr("d",function(a){return k(a.values)}).attr("stroke-width","2").attr("fill","none");var r=m[m.length-1].values,s=path.node().getTotalLength()+c(r[r.length-1].x);return path.attr("stroke-dasharray",s+" "+s).attr("stroke-dashoffset",s).transition().duration(1500).ease("linear").attr("stroke-dashoffset",0).attr("d",function(a){return k(a.values)}),angular.forEach(m,function(a){var d=o.selectAll(".circle").data(a.values).enter();d.append("circle").attr("cx",function(a){return c(a.x)}).attr("cy",function(a){return h(a.y)}).attr("r",3).style("fill",b.getColor(m.indexOf(a))).style("stroke",b.getColor(m.indexOf(a))).on("mouseover",function(){b.mouseover.call(b,arguments)}).on("mouseleave",function(){b.mouseleave.call(b,arguments)}).on("mousemove",function(){b.mousemove.call(b,arguments)}).on("click",function(){b.click.call(b,arguments)}),b.showLabels&&b.points.append("text").attr("x",function(a){return c(a.x)}).attr("y",function(a){return h(a.y)}).text(function(a){return a.y})}),q.append("text").datum(function(a){return{name:a.series,value:a.values[a.values.length-1]}}).attr("transform",function(a){return"translate("+c(a.value.x)+","+h(a.value.y)+")"}).attr("x",3).text(function(a){return a.name}),m};var angularCharts=angularCharts||{};angularCharts.pieChart=function(a,b){function c(a){a.innerRadius=0;var b=d3.interpolate({startAngle:0,endAngle:0},a);return function(a){return h(b(a))}}var d=b.getDimensions().width,e=b.getDimensions().height||d,f=Math.min(d,e)/2,g=d3.select(a[0]).append("svg").attr("width",d).attr("height",e).append("g").attr("transform","translate("+d/2+","+e/2+")"),h=d3.svg.arc().outerRadius(f-10).innerRadius(0);d3.svg.arc().outerRadius(f+5).innerRadius(0);var i=d3.layout.pie().sort(null).value(function(a){return a.y[0]}),j=g.selectAll(".arc").data(i(b.points)).enter().append("g");j.append("path").style("fill",function(a,c){return b.getColor(c)}).transition().ease("linear").duration(500).attrTween("d",c).attr("class","arc"),j.on("mouseover",function(){d3.select(this).select("path").transition().duration(200).style("stroke","white").style("stroke-width","2px"),b.mouseover.call(b,arguments)}).on("mouseleave",function(){d3.select(this).select("path").transition().duration(200).style("stroke","").style("stroke-width",""),b.mouseleave.call(b,arguments)}).on("mousemove",function(){b.mousemove.call(b,arguments)}).on("click",function(){b.mousemove.call(b,arguments)}),b.showLabels&&j.append("text").attr("transform",function(a){return"translate("+h.centroid(a)+")"}).attr("dy",".35em").style("text-anchor","middle").text(function(a){return a.data.y[0]})};var angularCharts=angularCharts||{};angularCharts.pointChart=function(a,b){function c(a){return Math.round(g(a))+g.rangeBand()/2}var d=b.getDimensions().width,e=b.getDimensions().height||d,f={top:0,right:40,bottom:20,left:40};d-=f.left-f.right,e-=f.top-f.bottom;var g=d3.scale.ordinal().domain(b.points.map(function(a){return a.x})).rangeRoundBands([0,d]),h=d3.scale.linear().range([e,10]),i=d3.svg.axis().scale(g).orient("bottom"),j=d3.svg.axis().scale(h).orient("left").ticks(5).tickFormat(d3.format("s")),k=[0],l=[];b.points.forEach(function(a){a.y.map(function(a){k.push(a)})});var m=d3.max(b.points.map(function(a){return a.y.length}));b.series.slice(0,m).forEach(function(a,c){var d={};d.series=a,d.values=b.points.map(function(a){return a.y.map(function(b){return{x:a.x,y:b}})[c]||{x:b.points[c].x,y:0}}),l.push(d)});var n=d3.select(a[0]).append("svg").attr("width",d+f.left+f.right).attr("height",e+f.top+f.bottom).append("g").attr("transform","translate("+f.left+","+f.top+")"),o=.2*d3.max(k);h.domain([d3.min(k),d3.max(k)+o]),n.append("g").attr("class","x axis").attr("transform","translate(0,"+e+")").call(i),n.append("g").attr("class","y axis").call(j),n.selectAll(".points").data(l).enter().append("g"),angular.forEach(l,function(a){var d=n.selectAll(".circle").data(a.values).enter();d.append("circle").attr("cx",function(a){return c(a.x)}).attr("cy",function(a){return h(a.y)}).attr("r",3).style("fill",b.getColor(l.indexOf(a))).style("stroke",b.getColor(l.indexOf(a))).on("mouseover",function(){b.mouseover.call(b,arguments)}).on("mouseleave",function(){b.mouseleave.call(b,arguments)}).on("mousemove",function(){b.mousemove.call(b,arguments)}).on("click",function(){b.click.call(b,arguments)}),b.showLabels&&b.points.append("text").attr("x",function(a){return c(a.x)}).attr("y",function(a){return h(a.y)}).text(function(a){return a.y})})};var angularCharts=angularCharts||{};angular.module("angularCharts",["angularChartsTemplates"]),angular.module("angularCharts").directive("acChart",["$templateCache","$compile","$window",function(){function a(){}return{restrict:"EA",link:a,controller:angularCharts.ChartController,scope:{acChart:"=",acData:"=",acConfig:"="}}}]),angular.module("angularCharts").directive("acLegend",["$templateCache","$compile","$window",function(a,b){function c(c,d){var e=a.get("legend");d.html(b(e)(c))}return{restrict:"EA",link:c,controller:["$scope",function(a){function b(){a.legends=[],"pie"==a.acLegend?angular.forEach(a.acPoints,function(b,c){a.legends.push({color:angularCharts.utils.colorPicker.getColor(c),title:b.x})}):angular.forEach(a.acSeries,function(b,c){a.legends.push({color:angularCharts.utils.colorPicker.getColor(c),title:b})})}a.$watch("acLegend",b,!0),a.$watch("acSeries",b,!0),a.$watch("acPoints",b,!0)}],scope:{acPoints:"=",acColors:"=",acLegend:"=",acSeries:"="}}}]),angular.module("angularChartsTemplates",["chart","legend"]),angular.module("chart",[]).run(["$templateCache",function(a){a.put("chart","<style>\n    .axis path,\n    .axis line {\n        fill: none;\n        stroke: #333;\n    }\n    .ac-line {\n        fill:none;\n        stroke-width:2px;\n    }\n</style>\n<div class='ac-chart' ></div>")}]),angular.module("legend",[]).run(["$templateCache",function(a){a.put("legend","<div class='ac-legend'>\n    <table>\n        <tr ng-repeat=\"l in legends\">\n            <td><div ng-attr-style='background:{{l.color}}; height:15px;width:15px;'></div></td>\n            <td ng-bind='l.title'></td>\n        </tr>\n    </table>\n</div>")}]);